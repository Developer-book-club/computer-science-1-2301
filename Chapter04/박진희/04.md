
# 4 데이터 베이스

# 4.1 데이터베이스의 기본 

#### 데이터 베이스 (DB, Data Base)
일정한 규칙 혹은 규약을 통해 구조화되어 저장되는 데이터 모음이다.  

#### DBMS (DataBase Management System)
데이버 베이스를 제어, 관리하는 통합 시스템으로 DBMS 마다 정의된 쿼리 언어를 통해 `create` / `select` / `insert` /`update`등을 수행할 수 있다.  
=> MySQL, MS SQL, Oracle 등. 

## 4.1.1. 엔터티(Entity)
정의: 사람 , 장소, 물건, 사건, 개념 등과 같이 독립적으로 존재하면서 고유하게 식별이 가능한 여러 개의 속성을 지닌 객체를 의미한다
- 실체, 객체라는 의미로 실무적으로는 앤터티라고 부르며 업무에 필요하고 유용한 정보를 저장하고 관리하기 위한 집합적인  것으로 설명할 수 있다.     
ex)[회원]이라는 엔터티가 있다면 회원은 이름, 아이디, 주소 등의 **속성**을 가진다.  

- **강한 엔터티**  
독립적으로 존재 가능한 것       
=> ex)건물, 회원   
- **약한 엔터티**    
강한 엔터티의 존재 여부에 따라 종속적인 것    
=> ex)방, 주민등록번호    



## 4.1.2.릴레이션
정의: 데이테베이스에서 정보를 구분하여 저장하는 기본 단위로, <u>엔터티에 관한 데이터를 </u> 데이터 베이스는 **하나의 릴레이션** 에 담아서 관리한다.  
- 관계형 DB 에서는 **테이블** 이라고 한다.  
[레코드(행)] ->**[테이블]** -> DB  
- NoSQL DB  **컬렉션** 이라고 한다.    
[도큐먼트]  -> **[컬렉션]**->[DB]  


## 4.1.3. 속성 
정의: 릴레이션에서 관리하는 구체적이며 고유한 이름을 갖는 정보이다.
- 서비스의 요구사항을 기반으로 관리해야 할 필요가 있는 필요가 있는(필수적인) 속성들만 엔터티의 속성이 된다.  


## 4.1.4. 도메인
도메인이란 릴레이션에 포함된 각각의 속성들이 가질 수 있는 값의 집합을 말한다.  
=> 회원이라는 엔터티의 [성별] 이라는 속성이 가질 수 있는 값 {남, 여}는 **집합(도메인)**이 된다.

![](https://velog.velcdn.com/images/wlsgml4563/post/402514c3-c6c6-47ce-af75-1e39144bf14a/image.png)


## 4.1.5.필드와 레코드
### 필드
데이터 베이스에서 세로 단위의 컬럼(`열(column)`,`속성`)을 말한다.

### 필드 타입
>숫자 타입       

|타입  |용량|  
|:------|:---:|  
|TINYINT|1|    
|SMALLINT|2|  
|MEDIUMINT|3|  
|INT|4|  
|BIGINT|8|

>날짜 타입

|날짜 타입|지원 범위|용량|값|
|-----|---|---|---|
| DATE|1000-01-01~9999-12-31|3바이트|날짜 o , 시간 x|
| DATETIME|1000-01-01 00:00:00 ~ 9999-12-31 23:59:59|8바이트|날짜 O 시간 O|
|TIMESTAMP|1970-01-01 00:00:01 ~ 2038-01-19 03:14:07|4바이트 |날짜O 시간 O|

>문자 타입
  - CHAR 와 VARCHAR  
     CHAR(N): 선언한 길이 값으로 고정되어 저장된다.  (N: 0~255)  
     VARCHAR(N): 입력된 데이터에 따라 용량을 가변시켜 저장된다.(N:0~65535)
 - TEXT 와  BLOB   
   TEXT 는 큰 문자열 저장에 쓰인다.  
   BLOB 은 이미지, 동영상 등 큰 데이터 저장에 쓰인다.
 - ENUM 와 SET  
    문자열을 열거하는 타입으로 원하는 상태 값으로 DB 에 저장할 수 있다.
  

### 레코드
데이터 베이스에서 하나의 단위로 취급되는 자료의 집합을 말한다,
DB 테이블에서 가로 방향의 한 줄(`행(Row)`or `튜플`)로 나타난다.

## 4.1.6. 관계
DB 에는 여러 개의 테이블이 존재하며 이러한 테이블은 **서로의 관계** 가 정의되어 있다. 이러한 관계를 **관계 화살표 ** 로 나타낸다.
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FchcqPU%2FbtqWNcpFqo5%2FTs0an1KgZHLuZs5ntTasK1%2Fimg.png)
- 1:1 관계  
하나의 레코드가 다른 테이블의 레코드 한 개와 연결된 경우이다.  
- 1:N 관계  
하나의 레코드가 서로 다른 여러 개의 레코드와 연결된 경우이다.
- N: M 관계  
여러 개의 레코드가 다른 테이블의 여러 개의 레코드와 관계가 있는 경우이다.

## 4.1.7 키
테이블 간의 관계를 명확하게 하고 테이블 자체의 인덱스를 위해 설정된 장치로 `기본키`, `외래키`, `후보키`,`슈퍼키`, `대체키` 가 있다.  
### 후보키 (Candidate Key)  
- 릴레이션을 구성하는 속성(컬럼)들 중에서 행을 유일하게 식별할 수 있는 속성들의 부분 집합을 의미한다.   
- 릴레이션에 있는 모든 행에 대해서 유일성과 최소성을 만족시켜야 한다.

### 기본키 (Primary Key)
- 후보키 중에서 선택한 메인 키로 한 릴레이션에서 특정 행을 유일하게 구별할 수 있는 속성이다.  
- 유일성과 최소성을 만족하며 기본키로 정의된 속성은 동일한 값이 중복되어 저장될 수 없다.

### 외래키 (Foreign Key)
- 다른 테이블의 기본키를 그대로 참조하는 값으로 릴레이션 간에 참조 관계를 표현하는데 중요한 도구이다.  
- 외래키로 지정되면 참조 테이블의 기본키에 없는 값은 입력할 수 없다.
### 대체키(Alternate Key)   
- 후보키가 두 개 이상일 경우 어느 하나를 기본키로 지정하고 남은 후보키들을 말한다.
### 슈퍼키(Super Key)  
- 슈퍼키는 한 릴레이션 내에 있는 속성들의 집합으로 구성된 키이다.    
- 각 레코드를 유일하게 식별할 수 있는 유일성을 갖춘 키이다.  
(최소성은 만족시키지 못한다.)
### 대체키(Alternate Key)
후보키가 두 개 이상일 경우 어느 하나를 기본키로 지정하고 남은 후보키들을 말한다.

# 4.2 ERD와 정규화 과정
## ERD 란?   
- 데이터베이스를 구축할 때 가장 기초적인 뼈대 역할을 하는 것  
- 릴레이션(테이블) 간의 관계들을 정의한 것
- 서비스 구축 시 가장 먼저 선행되어야 할 부분이다.  

> **💡ERD 의 중요성**  
> - ERD는 시스템의 요구 사항을 기반으로 작성되며 이 <u>ERD 를 기반으로 DB 를 구축한다.</u>  
> - DB 를 구축한 이후에도 디버깅 또는 비즈니스 프로세스 재설계가 필요한 경우에 설계도 역할을 담당하기도 한다.  
> - ERD는 관계형 구조로 표현할 수 있는 데이터를 구성하는데 유용하다.  
> - 미리 정의된 데이터 모델이 없는 비구조화 데이터, 즉 비정형 데이터는 ERD로 충분히 표현하기 어렵다.

## 정규화 과정  [🔎](https://hoyeonkim795.github.io/posts/normalization-course/)
#### 정의   
데이터의 **중복** 을 줄이고 **무결성**을 향상시키는 등 여러 목적을 달성하기 위해서 재디자인 하는 것을 말한다.
#### 목적   
릴레이션 간의 잘못된 종속 관계로 인해 **데이터 베이스 이상 현상**이 일어나서 이를 해결하거나, 저장 공간을 효율적으로 사용하기 위해 **릴레이션을 여러 개로 분리하는 과정이다.**  
#### 원칙
- 같은 의미를 표현하는 릴레이션이지만 더 좋은 구조로 만들어야 한다.  
- 자료의 중복성은 감소해야 한다.  
- 독립적인 관계는 별개의 릴레이션으로 표현해야 한다.  
- 각각의 릴레이션은 독립적인 표현이 가능해야 한다.    

✔️데이터베이스 이상 현상    
- 삽입 이상: 데이터를 삽입하기 위해 불필요한 데이터도 함께 삽입해야 하는 문제    
- 갱신 이상: 중복 행 중 일부만 변경하여 데이터가 불일치하게 되는 문제    
- 삭제 이상: 튜플을 삭제하면 꼭 필요한 데이터까지 같이 삭제되는 데이터 손실 문제    
 

> **제 1 정규형** 
- 릴레이션의 모든 도메인(속성의 값들)이 오직 원자 값(automic value) 만으로 구성되어야 한다.
- 모든 속성에 반복되는 그룹(집합)이 나타나지 않아야 한다.      

>**제 2 정규형**  
- 릴레이션이 제 1규형이며 **부분 함수의 종속성 **을 제거한 형태를 말한다.  
- 제 2 정규화는 테이블의 모든 컬럼이 완전 함수적 종속을 만족한다.

✔️부분 함수의 종속성 제거: 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속적인 것

>**제 3 정규형**  
- 비주요 속성(기본키가 아닌 속성)이 비주요 속성에 의해 종속되는 경우가 없는 릴레이션 형태를 말한다.  
- 기본키가 아닌 모든 속성이 **이행적 함수 종속**을 만족하지 않는 상태를 말한다.  

✔️이행적 함수 종속 : A -> B , B-> C 의 가 존재하면 논리적으로 A->C 가 추론되는데, 이때 C 가 A에 이행적으로 함수 종속되었다고 한다.    

>**보이스/코드 정규형**
- BCNF(Boyce and Codd Normal Form) 은 결정자가 후보키가 아닌 함수 종속 관계를 제거하여 모든 **결정자**가 후보키 집합에 속한 상태를 말한다.  

✔️결정자 : 함수 종속 관계에서 특정 종속자를 결정 짓는 요소로, X ->Y일 때,  <u>X 는 결정자 , Y는 종속자</u>  
![](https://velog.velcdn.com/images/wlsgml4563/post/a32838e9-ada8-4418-a1e5-11f3eef28d90/image.png)
강사 -> 수강명, 강사는 결정자

>** 제 4 정규형 : 다치 종속 제거**  

>** 제 5 정규형: 조인 종속성 제거**


# 4.3 트랜잭션과 무결성

## 4.3.1 트랜잭션
### 트랜잭션이란?
DB 에서 하나의 논리적 기능을 수행하기 위한 작업의 단위를 말하며 DB 에 접근하는 쿼리이다.<u>즉 여러 개의 쿼리들을 하나로 묶는 단위를 말한다.</u>   

### 트랜잭션의 특징

원자성, 일관성, 독립성, 지속성이 있으며 이를 한꺼번에 ACID 특징이라고 한다.

#### 원자성(atomicity)  
원자성은 트랜잭션과 관련된 일이 모두 수행되었거나 되지 않았거나를 보장하는 특징이다.

>**커밋**  
> 여러 쿼리가 성공적으로 처리되었다고 확정하는 명령어로, <u>트랜잭션 단위로 수행되며</u> 변경된 내용이 모두 영구적으로 저장되는 것을 말한다.

>**롤백**  
> 에러나 여러 이슈로 트랜잭션 전으로 돌려야 할 때 사용하는 것으로,트랜잭션으로 처리한 하나의 묶음 과정을 <u>일어나기 전으로 돌리는 일</u>을 말한다.


#### 일관성(consistency)   
<u>허용된 방식</u> 으로만 데이터를 변경해야 하는 것을 의미한다. DB 에 저장된 모든 데이터는 여러 가지 조건, 규칙에 따라 유효함을 가져야 한다.

#### 격리성(isolation)  
트랜잭션 수행 시 서로 끼어들지 못하는 것을 말한다.  

> **격리 수준에 따라 발생하는 현상**
> - 팬텀 리드 Phantom read
> 한 트랜잭션 내에서 동일한 쿼리를 보냈을 때 해당 조회 결과가 다른 경우를 말한다.  => 다른 행이 선택되어 출력될 수 있다.  
> - 반복 가능하지 않은 조회 Non repeatable read   
> 한 트랜잭션 내의 같은 행에 두 번 이상 조회가 발생했는데, 그 값이 다른 경우를 말한다. => 행 값이 달라질 수 있다.  
> - 더티 리드 Dirty read   
> 한 트랜잭션이 실행 중일 때 다른 트랜잭션에 의해 수정되었지만 아직 **'커밋되지 않은 행의 데이터'**를 읽을 수 있을 떄 발생한다.  

> **격리 수준**  
> - Serializable  
>   - 트랜잭션을 순차적으로 진행시키는 것을 말한다.   
>   - 매우 엄격한 수준으로 교착 상태가 일어날 확률이 많고 가장 성능이 떨어지는 격리 수준이다.
>  - Repeatable_Read  
>   - 하나의 트랜잭션이 수정한 행을 다른 트랜잭션이 수정할 수 없도록 막아주지만 새로운 행을 추가하는 것은 막지 않는다.  
>   - 이후에 추가된 행이 발견될 수 있다.    
>  - Read Committed  
>   - 커밋 완료된 데이터에 대해서만 조회를 허용한다.
>   - 어떤 트랜잭션이 접근한 행을 다른 트랜잭션이 수정할 수 있다.     
>   - 팬텀 리드와 반복 가능하지 않은 조회가 일어날 수 있다.
>  - Read Uncommitted    
>   - 트랜잭션에서 처리 중인 아직 커밋되지 않은 데이터를 다른 트랜잭션이 읽는 것을 허용한다.  
>   - 팬텀 리드, 반복 가능하지 않은 조회, 더티 리드가 일어날 수 있다.


#### 지속성(durability)
성공적으로 수행된 트랜잭션은 영원히 반영되어야 하는 것을 의미한다. 

## 4.3.2 무결성
### 무결성이란? 
데이터의 정확성, 일관성, 유효성을 유지하는 것을 말한다.  무결성이 유지되어야 DB에 저장된 데이터 값과 그 값에 해당하는 현실 세계의 실제 값이 일치하는지에 대한 신뢰가 생긴다.  

### 무결성 종류
#### 개체 무결성   
기본키로 선택된 필드는 빈 값을 허용하지 않는다.
####참조 무결성  
서로 참조 관계에 있는 두 테이블의 데이터는 항상 일관된 값을 유지해야 한다.
#### 고유 무결성  
특정 속성(열)에 대해 고유한 값을 가지도록 조건이 주어진 경우 그 속성 값은 모두 고유한 값을 가진다.  
#### NULL 무결성  
특정 속성 값에 NULL이 올 수 없다는 조건이 주어진 경우 그 속성 값은 NULL 이 될 수 없다는 제약 조건이다.


