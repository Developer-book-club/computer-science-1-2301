# 3.1 운영체제와 컴퓨터

### 운영체제란?
운영체제(OS, Operating System) 는 사용자가 컴퓨터를 쉽게 다루게 해주는 인터페이스를 말한다.   
💡운영체제와 유사하지만 소프트웨어를 추가로 설치할 수 없는 것을 <u>**펌웨어**</u> 라고 한다.  

## 3.1.1 운영체제의 역할과 구조 


### 운영체제의 역할

#### 1. CPU 스케줄링과 프로세스 관리   
CPU 소유권을 <u>어떤 프로세스에 할당할지 / 프로세스의 생성과 삭제 / 자원 할당 및 반환을 관리</u>

####  2. 메모리 관리
한정된 메모리를 어떤 프로세스에 <u>  얼만큼 할당해야 하는지 </u> 관리


#### 3. 디스크 파일 관리 
디스크 파일을 <u>어떤 방법으로 보관할지 </u>관리  


#### 4. I/O 디바이스 관리 
I/O 디바이스들인 마우스, 키보드와 컴퓨터 간에 데이터를 주고 받는 것을 관리


### 운영체제의 구조 

![mblogthumb-phinf.pstatic.net](https://mblogthumb-phinf.pstatic.net/MjAyMTA1MTFfMTIy/MDAxNjIwNjk2OTA3MjQ1.xd95k_7YwFM2c04e7qBR2i7QE4f1MiR3EZKR3CQkcNwg.u_oHTl7fSIesXv8hjyu0_szeRjb4qWSLnGsBKp4vUPgg.PNG.changwoo7463/333.PNG?type=w800)


▲출처 : [m.blog.naver.com](https://m.blog.naver.com/changwoo7463/222345318897)

- __ GUI  (Graphic User Interface)__    
`단순 명령어 창`이 아닌 아이콘, 스크롤바, 단추 등을 마우스로 클릭하는 단순 동작을 통해 컴퓨터와 상호 작용할 수 있게 해준다. 

 `단순 명령어 창` : 그래픽이 아닌 명령어로 처리하는 인터페이스 => **CUI**

-  __시스템콜__  
운영체제의 커널이 제공하는 서비스 사용를 받기 위해 유저 프로그램의 요청에 따라 커널에 접근하기 위한 인터페이스
   -  I/O 요청으로 트랩을 발동하면 올바른 요청인지 확인한 후, `유저모드` 가 시스템콜을 통해 `커널 모드` 로 변환되어 실행되고 다시 `유저모드`로 돌아가 유저프로그램 로직 수행
   -  컴퓨터 자원에 대한 직접 접근을 차단할 수 있고, 프로그램을 보호할 수 있다.

    > **유저모드와 커널모드의 구분**  
    > `유저모드` : 유저가 접근할 수 있는 영역을 제한적으로 두면 컴퓨터 자원에 함부로 침범하지 못하는 모드  
    > `커널모드` : 모든 컴퓨터 자원에 접근할 수 있는 모드  
    > 💡시스템콜이 작동될 때 **modebit**을 참고해서 유저모드와 커널모드를 구분한다.   
   > - modebit를 통해 사용자가 의도치 않은 컴퓨터 자원에 접근하는 것을 막는다.   
   > - modebit 1은 유저모드 / 0은 커널 모드라고 설정된다.  

- __커널__
컴퓨터 운영체제의 핵심이 되는 컴퓨터 프로그램 시스템으로 시스템의 모든 것을 완전히 통제한다.

![upload.wikimedia.org](https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/Kernel_Layout.svg/200px-Kernel_Layout.svg.png). 

  - **보안 역할 **  
     컴퓨터 하드웨어와 프로세스의 보안을 책임
  
  - **자원관리**  
     - 한정된 시스템 자원을 효율적으로 관리하여 프로그램의 실행을 원할하기 한다.  
     -  추상화
      운영체제의 복잡한 내부를 감추고 일관성 있는 인터페이스를 하드웨어에 제공하기 위해 `하드웨어 추상화` 들을 구현  
       `하드웨어 추상화` : 같은 종류의 장비에 대한 공통 명령어의 집합

- __드라이버__
하드웨어를 제어하기 위한 소프트웨어

---

## 3.1.2 컴퓨터의 요소

![mblogthumb-phinf.pstatic.net](https://mblogthumb-phinf.pstatic.net/MjAyMzAxMTNfMjc4/MDAxNjczNTk0MTUzNjMz.07e8TbvNN4Abl0lK2Vqil3cmcyfDjPZEwc0qul4I5nUg.NWsav4MMhBw-cHc0KhCu9-h0302GXoraqJg8zz3BToAg.PNG.mjjunghp/image.png?type=w800)


### CPU
**정의** : CPU(Central Processing Unit) 는 제어 장치 / 레지스터 / 산술논리연산장치로 구성되어 있는 컴퓨터 정치를 말하며, `인터럽트`에 의해 단순히 메모리에 존재하는 명령어를 해석해서 실행하는 일꾼이다.  
> **인터럽트**  
> 정의: 인터럽트는 어떤 신호가 들어왔을 때 CPU를 잠깐 정지시키는 것을 말한다.  
> 종류  
>-  하드웨어 인터럽트  
  키보드를 연결하거나 마우스를 연결하는 일 등의 IO 디바이스에서 발생하는 인터럽트
>- 소프트웨어 인터럽트  
  프로세스 오류 등으로 프로세스가 시스템콜을 호출할 때 발동한다. (<u>트랩</u>이라고도 한다.)  

> 처리 과정  
![interruptProcess](https://i.imgur.com/sA0vHHB.png)

**종류**
> 제어 장치(Control Unit, CU)  
CU는 프로세스 조작을 지시하는 CPU의 한 부품이다. 
 - 입출력 장치 간 통신을 제어
 - 명령어들을 읽고 해석
 - 데이터 처리를 위한 순서를 결정

> 레지스터(Register)  
레지스터는 CPU 안에 있는 매우 빠른 임시기억장치를 가르킨다. 
 - 명령어 주소, 명령어 코드, 연산에 필요한 데이터, 연산 결과를 임시로 저장한다.
 - CPU는 레지스터를 거쳐 데이터를 전달한다(CPU 자체적으로 데이터 저장할 방법이 없음)
 - `기억` `해석` `연산` `제어` 컴퓨터의 4대 주요 기능을 관할

> 산술논리연산장치(Arithmetic Logic Unit, ALU)  
  ALU 는 덧셈, 뺄셈 같은 두 숫자의 산술 연산과 배타적 논리합, 논리곱 같은 논리 연산을 계산하는 디지털 회로이다.



### DMA 컨트롤러  
I/ O 디바이스가 메모리에 직저 접근할 수 있도록 하는 하드웨어 장치를 뜻한다.  
- CPU 부하를 막아준다
- CPU의 일을 부담하는 보조 일꾼
- CPU와 DMA 컨트롤러가 동시에 작업 하는 것을 방지

### 메모리
전자회로에서 데이터나 상태, 명령어 등을 기록하는 장치를 말하며, 보통 RAM을 일컬어 메모리라고 한다.  

### 타이머  
특정 프로그램에 시간을 제한을 다는 역할로 시간이 만이 걸리는 프로그램이 작동할 떄 제한을 걸기 위해 존재


### 디바이스 컨트롤러  
컴퓨터와 연결되어 있는 IO 디바이스들의 작은 CPU 를 말한다.



---

# 3.2 메모리 
CPU 는 그저 **메모리** 에 올라와 있는 프로그램의 명령어들을 실행할 뿐이다. 

## 3.2.1 메모리 계층

▼메모리 계층   /  [출처🔎](https://velog.io/@tyjk8997/%EC%BA%90%EC%8B%9C%EC%99%80-%EA%B6%81%EA%B8%88%ED%95%9C%EC%A0%90)
![memory.png](https://velog.velcdn.com/images%2Ftyjk8997%2Fpost%2Feb21d273-c8c6-4aae-b1e2-7eec2c26d752%2Fimage.png)
- 레지스터
- 캐시(L1, L2 캐시)
- RAM (Random Access Memory)/주기억장치: 하드디스코로부터 일정량의 데이터를 복사해서 임시 저장하고 이를 필요 시마다 CPU에 빠르게 전달하는 역
- 보조기억장치(HDD,SDD)  

>** 계층의 특징  **  
> 속도: (빠름)레지스터 > 캐시> 주기억장치 > 보조기억장치 (느림)  
> 용량: (적음)레지스터 < 캐시< 주기억장치 < 보조기억장치 (많음)  
> 💡계층 위로 갈수록 가격은 비싸지며 용량은 작아지고 속도는 빨라지는 특징이 있다. 이렇듯 경제성과 캐시 때문에 계층을 두어 관리한다.

### 캐시
정의: 자주 사용하는 데이터나 값을 미리 복사해 놓는 **임시 저장소**이자 빠른 장치과 느린 장치에서 **속도 차이에 따른 병목 현상을 줄이기 위한 메모리**를 말한다.
> **지역성**  
> 모든 데이터를 캐시에 담기에는 저장 공간이 작기 때문에, 임시 저장할 데이터를 선별해야 하는데 이때 사용되는 것이 <u>지역성</u>이다.  
> - 시간 지역성  
> 특정 데이터가 한번 접근되었을 경우, 가까운 미래에 또 한번 데이터에 접근할 가능성이 높은 것을 말한다.  
> - 공간 지역성  
> 특정 데이터와 가까운 주소가 순서대로 접근되었을 경우를 공간적 지역성이라고 한다.

### 캐시히트와 캐시미스
**캐시히트** : 제어장치를 거쳐 캐시에서 원하는 데이터를 찾았다.  
**캐시미스**: 주메모리로 가서 데이터를 찾아오겠다.  
**캐시매핑**: 캐시가 히트되기 위해 매핑하는 방법을 말하며, <u>CPU의 레지스터와 주 메모리 간에 데이터를 주고받을 때를 기반으로 설명</u> `직접 매핑` / `연관 매핑` /`집합 연관 매핑`  
  > 캐시매핑의 종류  !(🔎참고)[https://gguljaem.tistory.com/entry/%EC%BA%90%EC%8B%9C%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%9D%98-%EA%B0%9C%EB%85%90%EA%B3%BC-%EB%A7%A4%ED%95%91%EA%B8%B0%EB%B2%95%EC%97%90-%EB%8C%80%ED%95%9C-%EC%84%A4%EB%AA%85]
  > - 직접 매핑: 메모리 주소와 순서를 일치시킨다. 적중률이 낮고 성능이 낮은 단순한 방식이다.  
  >- 연관 매핑: 순서를 일치시키지 않아 탐색 시간은 느리지만 관련 있는 캐시와 메모리를 매핑하여 적중률이 높다.   
  >- 집합 연관 매핑: 순서는 일치시키지만 집합을 둬서 저장하며 블록화되어 있기 때문에 검색은 좀 더 효율적이다.  

**웹브라우저의 캐시**   `쿠키` / `로컬 스토리지` / `세션 스토리지 `  
보통 사용자 정보나 인증 모듈 관련 사항들을 웹 브라우저에 저장해서 추후 서버에 요청할 때 자신을 나타내는 신원이나 중복 요청 방지를 위해 쓰인다.


** 데이터베이스의 캐싱 계층**  
DB 시스템 구축 시에 메인 DB 위에 **레디스(redis)DB 계층** 을 '캐싱 계층' 으로 둬서 성능을 향상시키기도 한다.

## 3.2.2 메모리 관리  
### 가상 메모리
가상 메모리는메모리가 실제 메모리보다 많아 보이게 하는 기술로, 어떤 프로세스가 실행될 때 메모리에 해당 프로세스 전체가 올라가지 않더라도 실행이 가능하다는 점에 착안하여 고안되었다.
- 빠르고 작은 메인 메모리를 느린 기억장치(디스크)와 병합하여, 하나의 크고 빠른 기억 장치**(가상 메모리)**처럼 동작하게 하는 것이다.
- 가상 메모리를 구현하기 위해서  특수 메모리 관리 하드웨어인 **메모리 관리 장치(MMU)**를 갖추고 있어야 한다.    
     ><u>가상 주소를 실제 주소(물리주소)로 변환하고 메모리를 보호하는 기능을 수행함.</u>  
- 가상 메모리는 가상 주소(logical address)와 실제 주소(physical address)가 매핑되어 있고 프로세스의 주소 정보가 들어 있는 **페이지 테이블**로 관리된다.
이때 <u>속도 향상</u>을 위해 💡**TLB**를 쓴다.  
  
  > **TLB**: MMU 에 포함되어 있는 주소 변환 캐시이다.  
  > CPU 가 가상 주소를 가지고 메모리에 접근하려고 할 때 우선은    TLB 에 접근하여 가상 주소에 해당되는 물리 주소를 찾고, 만약 TLB 에 매핑이 존재하지 않는다면 MMU 가 페이지 테이블에서 해당되는 물리 주소로 변환한 후 메모리에 접근하게 됨


### 스와핑  
가상 메모리에는 존재하지만 실제 메모리(RAM)에는 현재 없는 데이터나 코드에 접근할 경우 **페이지 폴트** 가 발생한다. 이떄 메모리에서 당장 사용하지 않는 영역을 하드디스크로 옮기고 <u> 하드디스크의 일부분을 마치 메모리처럼 불러와 쓰는 것을 **스와핑**이라고 한다.</u>

### 페이지 폴트
프로세스의 주소 공간에는 존재하지만 컴퓨터의 실제 메모리(RAM)에는 없는 데이터에 접근했을 경우 발생한다.
https://blog.naver.com/kgr2626/222147205118  
 ✔️페이지 가상 메모리를 사용하는 최소 크기 단위   
 ✔️프레임 실제 메모리를 사용하는 최소 크기 단위  

> 1. CPU는 실제 메모리를 확인하여 해당 페이지가 없으면 트랩을 발생해서 운영체제에게 알린다.
2. 운영체제는 CPU의 동작을 잠시 중지한다
3. 운영체제는 `페이지 테이블`을 확인하여 가상 메모리에 페이지가 존재하는지 확인하고, <u>페이지가 없으면</u> 프로세스를 중단하고 현재 실제 메모리에 비어있는 `프레임`이 있는지 찾는다.
4. 없다면 **스와핑**이 발동된다.
4. 있다면 비어 있는 `프레임`에 해당페이지를 로드하고,` 페이지 테이블`을 최신화한다.
5. 중단되었던 CPU 를 다시 시작한다. 


### 스레싱
메모리의 페이지 폴트율이 높은 것을 의미하여, 이는 컴퓨터의 성능 저하를 초래한다. 

### 메모리 할당
메모리에 프로그램을 할당할 때 시작 메모리 위치, 메모리 할당 크기를 기반으로 할당한다.

> **연속 할당**  
메모리에 순차적으로(연속적으로) 공간을 할당하는 것을 말한다.
- 고정 분할 방식: 메모리가 미리 나누어 관리한다.  
   ❗내부 단편화 발생: 메모리를 나눈 크기 > 프로그램 => 들어가지 못하는 공간이 많이 발생
- 가변 분할 방식: 매 시점 프로그램의 크기에 맞게 동적으로 메모리를 나눠 사용한다.  
  ❗외부 단편화 발생: 메모리를 나눈 크기 < 프로그램 => 
들어가지 못하는 공간이 많이 발생 
  - 가변 분할 방식 종류: 최초적합 / 최적적합 / 최악접합  

>**불연속 할당**  
메모리를 동일한 크기의  [`페이징(페이지단위)`or  `세그먼트(의미 단위)`] 로 나누고 프로그램마다 페이지 테이블을 두어 이를 통해  메모리에 프로그램을 할당하는 것이다.  
✔️`페이지드 세그멘테이션`: 공유나 보안=>세그먼트 / 물리적 메모리 => 페이지로 나누는 것

### 페이지 교체 알고리즘
스와핑이 많이 일어나지 않도록 페이지 교체 알고리즘을 기반으로 스와핑이 일어난다.

#### 오프라인 알고리즘  
먼 미래에 참조되는 페이지와 현재 할당하는 페이지를 바꾸는 알고리즘

#### FIFO
가장 먼저 온 페이지를 교체 영역에 가장 먼저 놓는 방법

#### LRU
최근에 가장 오랫동안 사용하지 않은 페이지를 교체하는 것
#### NUR
최근에 사용하지 않은 페이지를 교체하는  것
#### LFU
많이 사용되지 않은 것을 교체하는 것


# 3.3 프로세스와 스레드

✔️프로세스  
컴퓨터에서 실행되고 있는 프로그램을 말한다. ( CPU 스케줄링의 대상이 되는작업(task)이라는 용어와 거의 같은 의미로 사용된다.)  
✔️스레드  
프로세스 내 작업의 흐름을 지칭한다.


#3.4CPU 스케줄링 알고리즘

CPU 스케줄러는 CPU 스케줄링 알고리즘에 따라 프로세스에서 해야 하는 일을 스레드 단위로 CPU에 할당한다.
- 비선점형 `FCFS` / `SJF` / `우선순위`
- 선점형 `라운드로빈` / `SRF' /  `다단계 큐`

## 비선점형 방식 
비선점형 방식은 프로세스가 스스로 CPU 소유권을 포기하는 방식이며, 강제로 프로세스를 중지하지 않는다.  
컨텍스트 스위칭으로 인한 부하가 적다.
### FCFS (First Come, First Served)
가장 먼저 온 것을 가장 먼저 처리하는 알고리즘  
- 길게 수행되는 프로세스 떄문에 '준비 큐에서 오래 기다리는 현상(convoy effect)'이 발생하는 단점이 있다.
### SJF (Shortest Job First) 
SJF는 실행 시간이 가장 짧은 프로세스를 가장 먼저 실행하는 알고리즘  
긴 시간을 가진 프로세스가 실행되지 않는 현상(starvation)이 일어나며 평균 대기 시간이 짧다.  
### 우선순위
오래된 작업일수록 '우선순위를 높이는 방법(aging)' 을 통해 SJF 의 starvation 현상을 보완한 알고리즘

## 선점형 방식
선점형 방식은 현대 운영체제가 쓰는 방식으로 지금 사용하고 있는 프로세스를 알고리즘에 의해 중단시켜 버리고 강제로 다른 프로세스를 CPU 소유권을 할당하는 방식을 말한다.

### 라운드 로빈 (RR, Round Robin)
라운드 로빈은 우선순위 스케줄링의 일종으로 각 프로세스는 동일한 할당 시간을 주고 그 시간 안에 끝나지 않으면 큐(ready queue)의 뒤로 가는 알고리즘이다.  
### SRF
SRF 는 중간에 더 짧은 작업이 들어오면 수행하던 프로세스를 중지하고 해당 프로세스를 수행하는 알고리즘이다.
### 다단계 큐
다단계 큐는 우선순위에 따른 준비 큐를 여러 개 사용하고, 큐마다 라운드 로빈이나 FCFS 등 다른 스케줄링 알고리즘을 적용한 것을 말한다.
- 높은 우선 순위 - 시스템 프로세스 -**FCFS**
- 중간 우선 순위 - 상호 작용적인 프로세스 -**SJF**
- 낮은 우선순위 - 배치 프로세스 - **RR**


